<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Meta taagas required -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- fav-icon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/fav-icos/braces-asterisk.svg">
    <title>Detalles del Producto</title>
    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet"> 
    <!-- Enlazar Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Css -->
    <link rel="stylesheet" href="/assets/css/Producto-detalle.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5 mb-4">Detalles del Producto</h1>
        <div id="listaProductos"></div>
        <div id="totalContainer" class="mt-4">
            <h3>Total: <span id="total">0.00</span></h3>
            <h4 id="descuento" class="text-success"></h4>
            <h3>Total a Pagar: <span id="totalPagar">0.00</span></h3>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const listaProductos = document.getElementById('listaProductos');
            const totalElement = document.getElementById('total');
            const descuentoElement = document.getElementById('descuento');
            const totalPagarElement = document.getElementById('totalPagar');

            function actualizarCarrito(carrito, cantidadProductos) {
                listaProductos.innerHTML = '';
                let total = 0;
                let cantidadTotalProductos = 0;

                carrito.forEach((producto, index) => {
                    total += producto.precio * producto.cantidad;
                    cantidadTotalProductos += producto.cantidad;

                    const productoHTML = `
                        <div class="card mb-3">
                            <div class="row g-0">
                                <div class="col-md-4">
                                    <img src="${producto.imagen}" class="card-img-top" alt="${producto.nombre}">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-title">${producto.nombre}</h5>
                                        <p class="card-text">S/ ${producto.precio}</p>
                                        <div class="btn-cantidad">
                                            <button class="btn btn-danger me-2" onclick="cambiarCantidad(${index}, -1)">-</button>
                                            <span class="cantidad">${producto.cantidad}</span>
                                            <button class="btn btn-success ms-2" onclick="cambiarCantidad(${index}, 1)">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    listaProductos.insertAdjacentHTML('beforeend', productoHTML);
                });

                // Calcular descuento según la cantidad de productos
                let descuento = 0;
                if (cantidadTotalProductos >= 10) {
                    descuento = total * 0.30;
                } else if (cantidadTotalProductos >= 6) {
                    descuento = total * 0.25;
                } else if (cantidadTotalProductos >= 3) {
                    descuento = total * 0.10;
                }

                const totalConDescuento = total - descuento;

                // Mostrar el descuento y el total a pagar
                if (descuento > 0) {
                    descuentoElement.textContent = `Descuento aplicado: -S/ ${descuento.toFixed(2)}`;
                } else {
                    descuentoElement.textContent = '';
                }

                totalElement.textContent = `S/ ${total.toFixed(2)}`;
                totalPagarElement.textContent = `S/ ${totalConDescuento.toFixed(2)}`;

                localStorage.setItem('carrito', JSON.stringify(carrito));
                localStorage.setItem('cantidadProductos', cantidadTotalProductos);
                document.getElementById('carritoCantidad').textContent = cantidadTotalProductos;
            }

            window.cambiarCantidad = function(index, cambio) {
                const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
                if (carrito[index].cantidad + cambio > 0) {
                    carrito[index].cantidad += cambio;
                } else {
                    carrito.splice(index, 1);
                }
                const cantidadProductos = carrito.reduce((total, producto) => total + producto.cantidad, 0);
                actualizarCarrito(carrito, cantidadProductos);

                // Mostrar mensaje temporal de "Cantidad actualizada"
                mostrarMensaje('Cantidad actualizada.');
            }

            document.addEventListener('carritoActualizado', function(event) {
                const { carrito, cantidadProductos } = event.detail;
                actualizarCarrito(carrito, cantidadProductos);
            });

            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            if (carrito.length === 0) {
                listaProductos.innerHTML = '<p>No hay productos en el carrito.</p>';
            } else {
                const cantidadProductos = carrito.reduce((total, producto) => total + producto.cantidad, 0);
                actualizarCarrito(carrito, cantidadProductos);
            }

            function mostrarMensaje(mensaje) {
                const mensajeDiv = document.createElement('div');
                mensajeDiv.classList.add('mensaje-agregado');
                mensajeDiv.textContent = mensaje;
                document.body.appendChild(mensajeDiv);

                setTimeout(function() {
                    mensajeDiv.remove(); // Eliminar el mensaje después de 3 segundos
                }, 3000); // 3000 milisegundos = 3 segundos
            }
        });
    </script>
</body>
</html>


